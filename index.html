<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Study Planner - King's College London</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    /* ===== THEME COLORS ===== */
    [data-theme="dark"] {
      --bg-primary: #1a1a1a;
      --bg-secondary: #2d2d2d;
      --bg-tertiary: #3a3a3a;
      --text-primary: #ffffff;
      --text-secondary: #e0e0e0;
      --text-muted: #b0b0b0;
      --border-color: #404040;
      --card-bg: #2d2d2d;
      --input-bg: #3a3a3a;
    }

    [data-theme="light"] {
      --bg-primary: #f8f9fa;
      --bg-secondary: #ffffff;
      --bg-tertiary: #f8f9fa;
      --text-primary: #212529;
      --text-secondary: #495057;
      --text-muted: #6c757d;
      --border-color: #e9ecef;
      --card-bg: #ffffff;
      --input-bg: #ffffff;
    }

    body {
      font-family: 'Segoe UI', Roboto, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      transition: background 0.3s, color 0.3s;
      min-height: 100vh;
    }

    /* ===== HEADER ===== */
    .header {
      background: linear-gradient(135deg, #e52d27, #b31217);
      color: white;
      padding: 40px 0;
      box-shadow: 0 4px 20px rgba(229, 45, 39, 0.3);
    }
    .header-content {
      max-width: 1200px;
      margin: auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
    }
    .header h1 { font-size: 32px; margin-bottom: 5px; }
    .subtitle { font-size: 16px; opacity: 0.9; }
    .uni-name { font-size: 12px; letter-spacing: 2px; opacity: 0.85; }

    .header-actions { display: flex; gap: 10px; }
    .action-btn, .theme-toggle {
      border: 2px solid rgba(255,255,255,0.3);
      background: rgba(255,255,255,0.2);
      color: white;
      padding: 10px 16px;
      border-radius: 40px;
      cursor: pointer;
      transition: 0.3s;
    }
    .action-btn:hover, .theme-toggle:hover {
      background: rgba(255,255,255,0.3);
      transform: translateY(-2px);
    }

    /* ===== LAYOUT ===== */
    .main-container {
      display: grid;
      grid-template-columns: 350px 1fr;
      gap: 30px;
      max-width: 1200px;
      margin: auto;
      padding: 30px 20px;
    }
    @media (max-width: 1000px) {
      .main-container { grid-template-columns: 1fr; }
    }

    .left-panel, .right-panel {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: 12px;
      padding: 25px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }

    .panel-title {
      font-weight: 700;
      font-size: 20px;
      margin-bottom: 10px;
    }

    /* ===== FORM ===== */
    label { display: block; margin-bottom: 6px; font-weight: 600; }
    select {
      width: 100%;
      padding: 10px;
      border-radius: 8px;
      border: 2px solid var(--border-color);
      background: var(--input-bg);
      color: var(--text-primary);
      font-size: 14px;
      margin-bottom: 10px;
    }

    .calculate-btn {
      background: linear-gradient(135deg, #e52d27, #b31217);
      border: none;
      color: white;
      width: 100%;
      padding: 12px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }
    .calculate-btn:hover { transform: translateY(-2px); }

    .schedule-info {
      background: var(--bg-tertiary);
      padding: 15px;
      border-radius: 8px;
      border-left: 3px solid #17a2b8;
      display: none;
      margin-top: 15px;
      font-size: 14px;
    }
    .schedule-info.show { display: block; }

    /* ===== CALENDAR ===== */
    .calendar-container { display: none; }
    .calendar-container.show { display: block; }

    .calendar-grid {
      display: grid;
      grid-template-columns: 60px repeat(7, 1fr);
      grid-auto-rows: 22px;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      overflow: hidden;
      user-select: none;
    }
    .grid-header {
      background: var(--bg-tertiary);
      text-align: center;
      font-size: 11px;
      font-weight: 600;
      border: 1px solid var(--border-color);
      line-height: 22px;
    }
    .grid-cell {
      border: 1px solid var(--border-color);
      text-align: center;
      font-size: 10px;
      cursor: pointer;
      transition: 0.15s;
    }

    /* ===== COLORS ===== */
    .grid-cell.work { background: #e52d27; color: white; }
    .grid-cell.sleep { background: #6c757d; color: white; }
    .grid-cell.study { background: #28a745; color: white; }
    .grid-cell.commute { background: #fd7e14; color: white; }
    .grid-cell.family { background: #6f42c1; color: white; }
    .grid-cell.social { background: #ffc107; color: #212529; }
    .grid-cell.other { background: #96ceb4; color: white; }

    /* ===== STATS ===== */
    .stats-section { margin-top: 20px; display: none; }
    .stats-section.show { display: block; }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
      gap: 10px;
    }
    .stat-item {
      background: var(--bg-tertiary);
      border: 1px solid var(--border-color);
      border-radius: 8px;
      text-align: center;
      padding: 10px;
    }
    .stat-value { font-size: 18px; font-weight: 700; }
    .chart-container { max-width: 300px; margin: 15px auto; height: 200px; }

  </style>
</head>
<body data-theme="light">

  <div class="header">
    <div class="header-content">
      <div>
        <h1>Study Planner</h1>
        <div class="subtitle">Realistic recommendations for your schedule</div>
        <div class="uni-name">KING'S COLLEGE LONDON</div>
      </div>
      <div class="header-actions">
        <button id="printBtn" class="action-btn">Print</button>
        <button id="downloadBtn" class="action-btn">Download</button>
        <button id="themeToggle" class="theme-toggle">‚óê</button>
      </div>
    </div>
  </div>

  <div class="main-container">
    <!-- LEFT PANEL -->
    <div class="left-panel">
      <div class="panel-title">Your Commitments</div>
      <form id="calculatorForm">
        <label>Work Schedule</label>
        <select id="workSchedule">
          <option value="standard" data-hours="37.5" selected>Standard (9am‚Äì5pm)</option>
          <option value="part-time-16" data-hours="16">Part-time (9am‚Äì1pm)</option>
          <option value="extended-45" data-hours="45">Long (7am‚Äì5pm)</option>
        </select>

        <label>Work Pattern</label>
        <select id="workPattern">
          <option value="office-5" selected>Office 5 days</option>
          <option value="remote">Remote</option>
        </select>

        <label>Commute</label>
        <select id="commuteSchedule">
          <option value="none" data-hours="0">None</option>
          <option value="moderate" data-hours="7.5" selected>Moderate (1.5h/day)</option>
        </select>

        <label>Sleep Schedule</label>
        <select id="sleepSchedule">
          <option value="average" data-hours="49" selected>Average (10:30pm‚Äì6am)</option>
          <option value="good" data-hours="56">Good (10pm‚Äì6am)</option>
        </select>

        <button type="submit" class="calculate-btn">Generate Study Plan</button>
      </form>

      <div id="scheduleInfo" class="schedule-info">
        <div id="scheduleBreakdown"></div>
      </div>

      <div id="statsSection" class="stats-section">
        <h4 style="text-align:center;">Weekly Breakdown</h4>
        <div id="statsGrid" class="stats-grid"></div>
        <div class="chart-container"><canvas id="scheduleChart"></canvas></div>
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="right-panel">
      <div class="panel-title">Interactive Schedule</div>
      <div id="calendarContainer" class="calendar-container">
        <div>
          <label>Paint with:</label>
          <select id="activitySelect">
            <option value="study" selected>Study</option>
            <option value="commute">Commute</option>
            <option value="family">Family</option>
            <option value="social">Social</option>
            <option value="other">Other</option>
          </select>
          <button id="clearPersonal" class="action-btn" style="margin-left:10px;">Clear</button>
          <button id="smartSuggest" class="action-btn">Smart Fill</button>
        </div>
        <div class="calendar-grid" id="weeklyGrid"></div>
      </div>

      <div id="calendarPlaceholder" style="text-align:center; padding:80px; color:var(--text-muted);">
        <h3>üìÖ Your Schedule Will Appear Here</h3>
        <p>Select your work and sleep schedule to begin.</p>
      </div>
    </div>
  </div>

  <!-- ===== SCRIPT ===== -->
  <script>
    let scheduleChart;
    let isDragging = false;
    let currentActivity = 'study';

    // ==== FORM SUBMISSION ====
    document.getElementById('calculatorForm').addEventListener('submit', e => {
      e.preventDefault();
      const work = parseFloat(document.getElementById('workSchedule').selectedOptions[0].dataset.hours);
      const commute = parseFloat(document.getElementById('commuteSchedule').selectedOptions[0].dataset.hours);
      const sleep = parseFloat(document.getElementById('sleepSchedule').selectedOptions[0].dataset.hours);
      const total = work + commute + sleep;
      const available = 168 - total;

      document.getElementById('scheduleBreakdown').innerHTML = `
        Work: <strong>${work}h</strong><br>
        Commute: <strong>${commute}h</strong><br>
        Sleep: <strong>${sleep}h</strong><br>
        <span style="color:#28a745;">Available: <strong>${available}h/week</strong></span>
      `;
      document.getElementById('scheduleInfo').classList.add('show');
      populateSchedule(
        document.getElementById('workSchedule').value,
        document.getElementById('workPattern').value,
        document.getElementById('sleepSchedule').value,
        document.getElementById('commuteSchedule').value
      );
      document.getElementById('calendarPlaceholder').style.display = 'none';
      document.getElementById('calendarContainer').classList.add('show');
      addPlannerEventListeners();
    });

    // ==== BUILD GRID ====
    function initWeeklyGrid() {
      const grid = document.getElementById('weeklyGrid');
      grid.innerHTML = '';
      const days = ['Time', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
      days.forEach(d => {
        const h = document.createElement('div');
        h.className = 'grid-header';
        h.textContent = d;
        grid.appendChild(h);
      });
      for (let hour = 0; hour < 24; hour++) {
        const label = document.createElement('div');
        label.className = 'grid-header';
        label.textContent = `${hour}:00`;
        grid.appendChild(label);
        for (let day = 0; day < 7; day++) {
          const cell = document.createElement('div');
          cell.className = 'grid-cell';
          cell.dataset.day = day;
          cell.dataset.hour = hour;
          cell.addEventListener('mousedown', handleCellClick);
          cell.addEventListener('mouseover', handleCellDrag);
          grid.appendChild(cell);
        }
      }
    }

    // ==== AUTO POPULATE ====
    function populateSchedule(workType, workPattern, sleepType, commuteType) {
      initWeeklyGrid();
      const cells = document.querySelectorAll('.grid-cell');

      // sleep
      cells.forEach(c => {
        const h = +c.dataset.hour;
        if (h >= 23 || h < 6) c.classList.add('sleep');
      });

      // work
      const workHours = { 'standard': { start: 9, end: 17 }, 'part-time-16': { start: 9, end: 13 }, 'extended-45': { start: 7, end: 17 } };
      const wh = workHours[workType] || workHours['standard'];
      cells.forEach(c => {
        const h = +c.dataset.hour, d = +c.dataset.day;
        if (d < 5 && h >= wh.start && h < wh.end) c.classList.add('work');
      });

      // commute
      const commuteTimes = { moderate: 1.5 };
      const commute = commuteTimes[commuteType] || 0;
      cells.forEach(c => {
        const h = +c.dataset.hour, d = +c.dataset.day;
        if (d < 5 && commute > 0) {
          if (h >= wh.start - commute && h < wh.start) c.classList.add('commute');
          if (h >= wh.end && h < wh.end + commute) c.classList.add('commute');
        }
      });
      updateStats();
    }

    // ==== CELL INTERACTION ====
    document.addEventListener('mousedown', () => (isDragging = true));
    document.addEventListener('mouseup', () => (isDragging = false));
    document.addEventListener('contextmenu', e => {
      if (e.target.classList.contains('grid-cell')) e.preventDefault();
    });

    function handleCellClick(e) {
      const c = e.target;
      if (e.button === 2) { c.className = 'grid-cell'; updateStats(); return; }
      if (c.classList.contains('work') || c.classList.contains('sleep')) return;
      c.className = 'grid-cell ' + currentActivity;
      updateStats();
    }

    function handleCellDrag(e) {
      if (!isDragging) return;
      const c = e.target;
      if (!c.classList.contains('grid-cell')) return;
      if (c.classList.contains('work') || c.classList.contains('sleep')) return;
      c.className = 'grid-cell ' + currentActivity;
      updateStats();
    }

    // ==== PLANNER CONTROLS ====
    function addPlannerEventListeners() {
      document.getElementById('activitySelect').addEventListener('change', e => currentActivity = e.target.value);
      document.getElementById('clearPersonal').addEventListener('click', () => {
        document.querySelectorAll('.grid-cell').forEach(c => {
          if (!c.classList.contains('work') && !c.classList.contains('sleep')) c.className = 'grid-cell';
        });
        updateStats();
      });
      document.getElementById('smartSuggest').addEventListener('click', () => {
        document.querySelectorAll('.grid-cell').forEach(c => {
          const h = +c.dataset.hour, d = +c.dataset.day;
          if (!c.classList.contains('work') && !c.classList.contains('sleep') && !c.classList.contains('commute')) {
            if ((h >= 18 && h < 22 && d < 5) || (h >= 10 && h < 18 && d >= 5)) c.classList.add('study');
          }
        });
        updateStats();
      });
    }

    // ==== STATS ====
    function updateStats() {
      const cells = document.querySelectorAll('.grid-cell');
      const stats = { work: 0, sleep: 0, study: 0, commute: 0, family: 0, social: 0, other: 0 };
      cells.forEach(c => { for (let k in stats) if (c.classList.contains(k)) stats[k]++; });
      document.getElementById('statsGrid').innerHTML = Object.entries(stats)
        .map(([k, v]) => `<div class="stat-item"><div class="stat-value">${v}</div><div class="stat-label">${k}</div></div>`).join('');
      document.getElementById('statsSection').classList.add('show');
      const ctx = document.getElementById('scheduleChart').getContext('2d');
      if (scheduleChart) scheduleChart.destroy();
      scheduleChart = new Chart(ctx, {
        type: 'doughnut',
        data: { labels: Object.keys(stats), datasets: [{ data: Object.values(stats), backgroundColor: ['#e52d27','#6c757d','#28a745','#fd7e14','#6f42c1','#ffc107','#96ceb4'] }] },
        options: { plugins: { legend: { position: 'bottom' } } }
      });
    }

    // ==== THEME TOGGLE ====
    document.getElementById('themeToggle').addEventListener('click', () => {
      const body = document.body;
      body.dataset.theme = body.dataset.theme === 'light' ? 'dark' : 'light';
    });
  </script>
</body>
</html>
