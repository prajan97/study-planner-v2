<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Study Planner - King's College London</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #e52d27 0%, #b31217 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 24px;
      box-shadow: 0 30px 90px rgba(0,0,0,0.3);
      overflow: hidden;
    }
    .header {
      background: linear-gradient(135deg, #e52d27 0%, #b31217 100%);
      color: white;
      padding: 60px 40px;
      text-align: center;
    }
    .header h1 { font-size: 36px; margin-bottom: 12px; font-weight: 700; }
    .header .subtitle { font-size: 18px; opacity: 0.95; }
    .header .uni-name { margin-top: 15px; font-size: 13px; font-weight: 600; letter-spacing: 2px; opacity: 0.85; }
    .content { padding: 50px 40px; }
    .intro-text {
      background: #f8f9fa;
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 30px;
      border-left: 4px solid #e52d27;
      color: #495057;
      line-height: 1.7;
    }
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-bottom: 30px;
    }
    .input-group { position: relative; }
    label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: #212529;
      font-size: 15px;
    }
    select, input[type="number"] {
      width: 100%;
      padding: 16px;
      border: 2px solid #dee2e6;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: white;
      font-weight: 500;
    }
    select:focus, input[type="number"]:focus {
      outline: none;
      border-color: #e52d27;
      box-shadow: 0 0 0 4px rgba(229, 45, 39, 0.1);
    }
    .helper-text { font-size: 13px; color: #6c757d; margin-top: 6px; }
    .work-schedule-insight {
      background: linear-gradient(135deg, #e8f4f8 0%, #d4e9f2 100%);
      padding: 16px;
      border-radius: 8px;
      margin-top: 10px;
      border-left: 3px solid #17a2b8;
      font-size: 14px;
      color: #0c5460;
      font-weight: 500;
    }
    .calculate-btn {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #e52d27 0%, #b31217 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 20px;
      box-shadow: 0 8px 20px rgba(229, 45, 39, 0.25);
    }
    .calculate-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(229, 45, 39, 0.35);
    }
    .results {
      margin-top: 40px;
      display: none;
      animation: fadeInUp 0.6s ease-out;
    }
    .results.show { display: block; }
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .results-header { text-align: center; margin-bottom: 40px; }
    .results-header h2 { font-size: 32px; color: #212529; margin-bottom: 8px; font-weight: 700; }
    .stats-showcase {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 40px;
    }
    .stat-box {
      background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
      padding: 24px;
      border-radius: 12px;
      text-align: center;
      border: 2px solid #e9ecef;
      transition: all 0.3s ease;
    }
    .stat-box:hover {
      border-color: #e52d27;
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    }
    .stat-label {
      font-size: 12px;
      color: #6c757d;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 1px;
      font-weight: 600;
    }
    .stat-value { font-size: 36px; font-weight: 800; color: #e52d27; }
    .chart-container { background: #f8f9fa; padding: 30px; border-radius: 16px; margin: 40px auto; max-width: 600px; }
    .chart-title { font-size: 16px; font-weight: 700; color: #212529; margin-bottom: 20px; text-align: center; }
    .chart-wrapper { position: relative; height: 280px; }
    .recommendation {
      background: linear-gradient(135deg, #fff5f5 0%, #ffe8e8 100%);
      padding: 35px;
      border-radius: 16px;
      border-left: 6px solid #e52d27;
      margin-bottom: 30px;
    }
    .recommendation-title {
      font-size: 24px;
      font-weight: 700;
      color: #e52d27;
      margin-bottom: 16px;
    }
    .programme-suggestions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .programme-card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      border: 2px solid #e52d27;
      transition: all 0.3s ease;
    }
    .programme-card:hover { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(229,45,39,0.2); }
    .programme-name { font-size: 16px; font-weight: 700; color: #e52d27; margin-bottom: 8px; }
    .programme-details { font-size: 14px; color: #495057; line-height: 1.6; }
    .btn {
      padding: 16px 24px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
      text-align: center;
    }
    .btn-primary {
      background: linear-gradient(135deg, #e52d27 0%, #b31217 100%);
      color: white;
      box-shadow: 0 4px 12px rgba(229,45,39,0.25);
    }
    .btn-secondary {
      background: white;
      color: #e52d27;
      border: 2px solid #e52d27;
    }
    .btn-secondary:hover { background: #e52d27; color: white; }
    /* Weekly grid styles */
    .weekly-grid {
      display: grid;
      grid-template-columns: 60px repeat(7, 1fr);
      grid-auto-rows: 26px;
      border: 1px solid #dee2e6;
      user-select: none;
      margin-top: 15px;
    }
    .grid-header {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      font-size: 12px;
      text-align: center;
      line-height: 26px;
      font-weight: 600;
    }
    .grid-cell {
      border: 1px solid #f1f1f1;
      text-align: center;
      cursor: pointer;
      transition: background 0.15s ease;
      font-size: 11px;
    }
    .grid-cell.study { background: #28a745; color: white; }
    .grid-cell.family { background: #ff6b6b; color: white; }
    .grid-cell.social { background: #ffc107; color: #212529; font-weight:600; }
    .grid-cell.commute { background: #17a2b8; color: white; }
    .grid-cell.other { background: #6c757d; color: white; }
    .grid-cell:hover { opacity: 0.85; }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Study Planner</h1>
      <div class="subtitle">Realistic recommendations for your schedule</div>
      <div class="uni-name">KING'S COLLEGE LONDON</div>
    </div>
    <div class="content">
      <div class="intro-text">
        <p><strong>Get realistic study recommendations.</strong> Finding your available study time by factoring in commutes, downtime, and commitments.</p>
      </div>
      <form id="calculatorForm">
        <!-- existing form fields -->
        <div class="form-grid">
          <div class="input-group">
            <label>Work & Commute Schedule</label>
            <select id="workSchedule">
              <option value="40" selected>Standard: 9am-5pm (40 hrs/week)</option>
            </select>
            <input type="number" id="work" min="0" max="168" value="40" required style="display:none;">
          </div>
          <div class="input-group">
            <label>Sleep Schedule (hours/week)</label>
            <input type="number" id="sleep" min="0" max="168" value="49" required>
          </div>
          <div class="input-group">
            <label>Family Commitments (hours/week)</label>
            <input type="number" id="family" min="0" max="168" value="20" required>
          </div>
          <div class="input-group">
            <label>Social & Leisure (hours/week)</label>
            <input type="number" id="social" min="0" max="168" value="25" required>
          </div>
          <div class="input-group">
            <label>Other Commitments (hours/week)</label>
            <input type="number" id="other" min="0" max="168" value="10" required>
          </div>
        </div>
        <button type="submit" class="calculate-btn">Generate Study Plan</button>
      </form>

      <div id="results" class="results">
        <div class="results-header">
          <h2>Your Realistic Study Plan</h2>
          <p>Based on your actual schedule</p>
        </div>
        <div class="stats-showcase">
          <div class="stat-box"><div class="stat-label">Weekly</div><div class="stat-value" id="weeklyHours">0h</div></div>
          <div class="stat-box"><div class="stat-label">Daily Avg</div><div class="stat-value" id="dailyHours">0h</div></div>
          <div class="stat-box"><div class="stat-label">Monthly</div><div class="stat-value" id="monthlyHours">0h</div></div>
        </div>
        <div class="chart-container">
          <div class="chart-title">Weekly Time Allocation</div>
          <div class="chart-wrapper"><canvas id="pieChart"></canvas></div>
        </div>
      </div>

      <!-- 🗓️ Weekly Visual Planner -->
      <div id="visualPlanner" style="display:none; margin-top:40px;">
        <h2 style="text-align:center; color:#212529; margin-bottom:20px;">Your Weekly Schedule</h2>
        <div style="text-align:center; margin-bottom:15px;">
          <label style="font-weight:600;">Select Activity:</label>
          <select id="activitySelect" style="padding:8px 14px; border-radius:8px; border:1px solid #dee2e6;">
            <option value="study" selected>📚 Study</option>
            <option value="family">🧍 Family Commitment</option>
            <option value="social">🎉 Social / Leisure</option>
            <option value="commute">🚌 Commuting</option>
            <option value="other">📦 Other</option>
          </select>
          <button id="clearGrid" class="btn btn-secondary" style="margin-left:10px;">Clear All</button>
        </div>
        <div id="weeklyGrid" class="weekly-grid"></div>
      </div>
    </div>
  </div>

  <script>
    // existing calculator
    document.getElementById('calculatorForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const work = parseFloat(document.getElementById('work').value);
      const sleep = parseFloat(document.getElementById('sleep').value);
      const family = parseFloat(document.getElementById('family').value);
      const social = parseFloat(document.getElementById('social').value);
      const other = parseFloat(document.getElementById('other').value);
      const totalCommitted = work + sleep + family + social + other;
      let available = 168 - totalCommitted;
      if (available < 0) available = 0;
      document.getElementById('weeklyHours').textContent = available.toFixed(0) + 'h';
      document.getElementById('dailyHours').textContent = (available/7).toFixed(1) + 'h';
      document.getElementById('monthlyHours').textContent = (available*4.33).toFixed(0) + 'h';
      createChart(work,sleep,family,social,other,available);
      document.getElementById('results').classList.add('show');
      document.getElementById('visualPlanner').style.display='block';
      setTimeout(()=>document.getElementById('results').scrollIntoView({behavior:'smooth'}),100);
    });

    let pieChart;
    function createChart(work,sleep,family,social,other,available){
      const ctx=document.getElementById('pieChart').getContext('2d');
      if(pieChart) pieChart.destroy();
      pieChart=new Chart(ctx,{
        type:'doughnut',
        data:{
          labels:['Work','Sleep','Family','Social','Other','Study'],
          datasets:[{data:[work,sleep,family,social,other,available],
            backgroundColor:['#e52d27','#6c757d','#ff6b6b','#ffc107','#96ceb4','#28a745'],
            borderWidth:0}]},
        options:{plugins:{legend:{position:'bottom'}}}
      });
    }

    // Weekly grid logic
    function initWeeklyGrid() {
      const grid=document.getElementById('weeklyGrid');
      const days=['Time','Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
      grid.innerHTML='';
      days.forEach(d=>{
        const div=document.createElement('div');
        div.className='grid-header';
        div.textContent=d;
        grid.appendChild(div);
      });
      for(let hour=0;hour<24;hour++){
        const label=document.createElement('div');
        label.className='grid-header';
        label.textContent=`${hour}:00`;
        grid.appendChild(label);
        for(let day=0;day<7;day++){
          const cell=document.createElement('div');
          cell.className='grid-cell';
          cell.dataset.day=day; cell.dataset.hour=hour;
          cell.addEventListener('mousedown',handleCellClick);
          cell.addEventListener('mouseover',handleCellDrag);
          grid.appendChild(cell);
        }
      }
    }
    let isDragging=false; let currentActivity='study';
    document.addEventListener('mousedown',()=>isDragging=true);
    document.addEventListener('mouseup',()=>isDragging=false);
    function handleCellClick(e){
      const cell=e.target;
      const activity=currentActivity;
      const wasSelected=cell.classList.contains(activity);
      cell.className='grid-cell';
      if(!wasSelected) cell.classList.add(activity);
      updateStats();
    }
    function handleCellDrag(e){
      if(!isDragging) return;
      const cell=e.target;
      if(!cell.classList.contains('grid-cell')) return;
      cell.className='grid-cell '+currentActivity;
      updateStats();
    }
    document.getElementById('activitySelect').addEventListener('change',e=>{
      currentActivity=e.target.value;
    });
    document.getElementById('clearGrid').addEventListener('click',()=>{
      document.querySelectorAll('.grid-cell').forEach(c=>c.className='grid-cell');
      updateStats();
    });
    function updateStats(){
      const cells=document.querySelectorAll('.grid-cell');
      const countBy={study:0,family:0,social:0,commute:0,other:0};
      cells.forEach(c=>{
        if(c.classList.length>1){
          const act=c.classList[1];
          countBy[act]++;
        }
      });
      document.getElementById('weeklyHours').textContent=countBy.study+'h';
      document.getElementById('dailyHours').textContent=(countBy.study/7).toFixed(1)+'h';
      document.getElementById('monthlyHours').textContent=(countBy.study*4.33).toFixed(0)+'h';
    }
    document.addEventListener('DOMContentLoaded',initWeeklyGrid);
  </script>
</body>
</html>
